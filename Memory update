import requests
import json
from datetime import datetime

# GitHub repo info
GITHUB_TOKEN = "YOUR_PERSONAL_ACCESS_TOKEN"
REPO_OWNER = "greysonbattlefront-eng"
REPO_NAME = "didactic-octo-lamp"
FILE_PATH = "memory.json"
API_URL = f"https://api.github.com/repos/{REPO_OWNER}/{REPO_NAME}/contents/{FILE_PATH}"

headers = {
    "Authorization": f"token {GITHUB_TOKEN}",
    "Accept": "application/vnd.github+json"
}

# Step 1: Get current file
response = requests.get(API_URL, headers=headers)
data = response.json()
file_sha = data['sha']
content = json.loads(requests.get(data['download_url']).text)

# Step 2: Append new conversation
new_entry = {
    "timestamp": datetime.utcnow().isoformat(),
    "speaker": "AI",
    "message": "This is a new memory entry generated by the AI.",
    "topic": "Memory"
}
content.append(new_entry)

# Step 3: Encode and update file
updated_content = json.dumps(content, indent=2)
update_data = {
    "message": "Add new memory entry",
    "content": updated_content.encode("utf-8").decode("utf-8"),
    "sha": file_sha
}

requests.put(API_URL, headers=headers, json=update_data)
print("Memory updated successfully!")
